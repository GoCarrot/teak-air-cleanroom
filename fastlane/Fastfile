# This file contains the fastlane.tools configuration
# You can find the documentation at https://docs.fastlane.tools
#
# For a list of all available actions, check out
#
#     https://docs.fastlane.tools/actions
#

# Uncomment the line if you want fastlane to automatically update itself
# update_fastlane
TEAK_APP_EXTENSIONS = ["TeakNotificationService", "TeakNotificationContent"]
CONFIG_TYPE = "development"

default_platform(:ios)

platform :ios do
  desc "Setup"
  lane :setup do
    ["io.teak.app.air.dev", "io.teak.app.air.prod"].each do |app_id|
      produce(
        app_identifier: app_id,
        app_name: "Teak Air Cleanroom",
        skip_itc: true,
        enable_services: {
          push_notification: "on",
          associated_domains: "on"
        }
      )
      match(
        app_identifier: app_id,
        type: CONFIG_TYPE,
        force: true
      )

      TEAK_APP_EXTENSIONS.each do |app_extension_name|
        produce(
          app_identifier: "#{app_id}.#{app_extension_name}",
          app_name: app_extension_name,
          skip_itc: true
        )
        match(
          app_identifier: "#{app_id}.#{app_extension_name}",
          type: CONFIG_TYPE,
          force: true
        )
      end
    end
  end
end
